<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Journal Junction</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #e63946;
      --secondary: #ffd60a;
      --accent: #fff9e0;
      --text-dark: #2d2d2d;
      --text-light: #6b6b6b;
      --border-light: #e8e8e8;
    }

    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #ffd60a 0%, #ff8c42 50%, #e63946 100%);
        background-attachment: fixed;
        color: var(--text-dark);
    }

    .container {
        max-width: 900px;
        margin: 40px auto;
        background: linear-gradient(135deg, #ffffff 0%, #fff9e0 100%);
        backdrop-filter: blur(10px);
        border-radius: 22px;
        padding: 28px;
        box-shadow: 0 12px 40px rgba(230, 57, 70, 0.12);
        border: 1px solid rgba(230, 57, 70, 0.1);
    }

    /* HERO */
    .hero { display:flex; gap:28px; align-items:center; margin-bottom:18px; }
    .hero-media img { width:220px; height:220px; object-fit:cover; border-radius:16px;
                      box-shadow:0 10px 30px rgba(124, 92, 220, 0.15); border:6px solid var(--accent); }
    .hero-content h1 { margin:0 0 8px 0; color:var(--primary); font-size:34px; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .hero-desc { margin:0 0 10px 0; color:var(--text-light); line-height:1.45; max-width:520px; }
    .hero-sub { margin:0; color:var(--primary); font-weight:600; }

    /* motivation area */
    .motivation-wrap { margin: 6px 0 18px 0; display:flex; flex-direction:column; gap:12px; }
    .mot-head { display:flex; align-items:center; justify-content:space-between; gap:16px; }
    .mot-title { font-weight:700; color:var(--primary); font-size:18px; }
    #motivationText {
      padding:14px 16px;
      border-radius:12px;
      background: linear-gradient(90deg, #fff5f8, #f5f0ff);
      box-shadow:0 6px 14px rgba(124, 92, 220, 0.08);
      color:var(--text-dark);
      min-height:56px;
      font-size:16px;
      border-left: 4px solid var(--secondary);
    }
    .mot-controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .mot-input { flex:1; min-width:220px; padding:10px 12px; border-radius:10px; border:1px solid #e8e8e8; background:var(--accent); }
    .btn {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(124, 92, 220, 0.25);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(124, 92, 220, 0.35);
    }
    .btn-alt {
      background: white;
      color:var(--primary);
      border:1.5px solid var(--primary);
    }

    /* gif carousel */
    #gifCarousel { display:flex; gap:12px; align-items:center; margin:8px 0 18px 0; }
    .carousel-item { width:96px; height:96px; object-fit:cover; border-radius:12px; box-shadow:0 6px 14px rgba(124, 92, 220, 0.1); border: 3px solid var(--accent); }

    /* avatar chooser */
    .avatar-chooser { display:flex; gap:12px; align-items:center; margin:10px 0 14px 0; }
    .avatar-chooser img { width:72px; height:72px; object-fit:cover; border-radius:12px; cursor:pointer;
                          border:3px solid transparent; transition:transform .12s, border-color .18s; }
    .avatar-chooser img.selected { border-color:var(--secondary); transform:translateY(-4px); box-shadow:0 10px 20px rgba(255, 107, 157, 0.2); }

    /* form */
    label { display:block; font-weight:600; color:var(--primary); margin-bottom:6px; }
    textarea, input[type="text"] {
        width:100%;
        padding:14px;
        font-size:15px;
        border-radius:14px;
        border:1.5px solid #e8e8e8;
        margin-top:8px;
        margin-bottom:18px;
        outline:none;
        background:var(--accent);
        color:var(--text-dark);
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    textarea:focus, input:focus { border-color:var(--secondary); box-shadow:0 0 0 3px rgba(255, 107, 157, 0.1); background:white; }

    .emoji-picker span { font-size:30px; cursor:pointer; margin-right:12px; transition:transform .18s; }
    .emoji-picker span:hover { transform:scale(1.2); }

    /* entries */
    .entry-card { background:white; padding:16px; border-radius:14px; margin-bottom:14px; box-shadow:0 6px 14px rgba(124, 92, 220, 0.08); border:1.5px solid #e8e8e8; display:flex; gap:12px; align-items:flex-start; transition: transform 0.2s, box-shadow 0.2s; }
    .entry-card:hover { transform: translateY(-2px); box-shadow:0 8px 20px rgba(124, 92, 220, 0.12); }
    .entry-card img { width:64px; height:64px; object-fit:cover; border-radius:12px; flex-shrink:0; }
    .entry-date { font-weight:600; color:var(--primary); margin-bottom:6px; }
    @media (max-width:820px) { .hero { flex-direction:column; text-align:center; } .hero-media img { width:260px; height:260px; } .entry-card { flex-direction:column; align-items:stretch; } .entry-card img { width:100%; height:180px; border-radius:12px; } }
  </style>
</head>

<body>
  <div class="container">

    <!-- HERO -->
    <div class="hero">
      <div class="hero-media">
        <img th:src="@{/images/s1.gif}" alt="hero gif"/>
      </div>
      <div class="hero-content">
        <h1>üåô Journal Junction</h1>
        <p class="hero-desc">A cozy place to write, reflect and grow. Answer short prompts, pick a mood and build a gentle journaling habit ‚Äî one small step at a time.</p>
        <p class="hero-sub">Free. Private. Beautifully simple.</p>
      </div>
    </div>

    <!-- MOTIVATION: Title, random quote, new quote + add custom -->
    <div class="motivation-wrap">
      <div class="mot-head">
        <div class="mot-title">‚ú® Motivations of the day</div>
        <div style="color:#8a3fae; font-weight:600;">Pick a quote to feel a little brighter</div>
      </div>

      <div id="motivationText">Loading uplifting quote...</div>

      <div class="mot-controls">
        <button id="newQuoteBtn" class="btn" type="button">New Quote</button>

        <!-- custom quote input -->
        <input id="customQuoteInput" class="mot-input" type="text" placeholder="Add your custom quote (then press Add)"/>
        <button id="addQuoteBtn" class="btn btn-alt" type="button">Add your custom quote</button>
      </div>
    </div>

    <!-- small gif carousel -->
    <!-- <div id="gifCarousel">
      <img class="carousel-item" th:src="@{/images/girl-1.gif}" alt="g1"/>
      <img class="carousel-item" th:src="@{/images/girl-2.gif}" alt="g2"/>
      <img class="carousel-item" th:src="@{/images/girl-3.gif}" alt="g3"/>
    </div> -->

    <!-- JOURNAL FORM -->
    <form th:action="@{/add}" method="post" th:object="${newEntry}">
      <!-- avatar chooser (user picks 1 of 3) -->
      <label>Choose your avatar</label>
      <div class="avatar-chooser" id="avatarChooser">
        <img id="a1" src="/images/girl-gif-1.gif" alt="girl1" data-name="girl-1.gif"/>
        <img id="a2" src="/images/girl-gif-2.gif" alt="girl2" data-name="girl-2.gif"/>
        <img id="a3" src="/images/s2.avif" alt="girl3" data-name="girl-3.gif"/>
      </div>
      <input type="hidden" th:field="*{avatar}" id="avatarField"/>

      <label>Write your journal</label>
      <textarea id="text" th:field="*{text}" placeholder="Share something about your day..." rows="5"></textarea>

      <label>‚ú® What are 3 things you love about yourself today?</label>
      <input th:field="*{q1}" placeholder="I am proud of myself for..."/>

      <label>üìò What did you learn today?</label>
      <input th:field="*{q2}" placeholder="Today I learned..."/>

      <label>üî• One challenge & how you handled it</label>
      <input th:field="*{q3}" placeholder="I managed..."/>

      <label>Choose your mood</label>
      <div class="emoji-picker" style="margin:8px 0;">
        <span onclick="setEmoji('üòÄ')">üòÄ</span>
        <span onclick="setEmoji('üôÇ')">üôÇ</span>
        <span onclick="setEmoji('üòê')">üòê</span>
        <span onclick="setEmoji('üòî')">üòî</span>
        <span onclick="setEmoji('üò§')">üò§</span>
      </div>

      <input type="hidden" id="emoji" th:field="*{emoji}"/>

      <div style="margin-top:8px;">
        <button class="btn" type="submit">Save Journal</button>
      </div>
    </form>

    <!-- Past entries -->
    <h2 style="margin-top:26px; color:#9245b8;">üìñ Past Entries</h2>

    <div th:if="${entries == null or #lists.isEmpty(entries)}">
      <p style="color:#6d4a67;">No entries yet ‚Äî write your first one!</p>
    </div>

    <div th:each="e : ${entries}">
      <div class="entry-card">
        <img th:src="@{/images/avatar.png}" alt="avatar"/>
        <div style="flex:1;">
          <div class="entry-date" th:text="${e.date}">2025-12-12</div>
          <div style="font-size:20px; margin-bottom:6px;" th:text="${e.emoji}">üòÄ</div>

          <!-- preview: truncated if long (fixed syntax) -->
          <div th:if="${e.text != null and e.text.length() > 200}"
               th:text="${#strings.substring(e.text, 0, 200) + '...'}"></div>
          <div th:unless="${e.text != null and e.text.length() > 200}"
               th:text="${e.text}"></div>

          <div style="margin-top:10px;">
            <a th:href="@{/entry/{id}(id=${e.id})}" style="text-decoration:none; color:#a652c7; font-weight:600;">Open</a>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- SCRIPTS -->
  <script>
    // emoji setter
    function setEmoji(val){ document.getElementById('emoji').value = val; }

    // avatar chooser logic
    (function(){
      const chooser = document.getElementById('avatarChooser');
      if(!chooser) return;
      const images = chooser.querySelectorAll('img');
      images.forEach(img=>{
        img.addEventListener('click', ()=>{
          images.forEach(i=> i.classList.remove('selected'));
          img.classList.add('selected');
          // save selected avatar filename to hidden field (backend receives it)
          document.getElementById('avatarField').value = img.getAttribute('data-name');
        });
      });
      // preselect first by default
      if(images.length) {
        images[0].classList.add('selected');
        document.getElementById('avatarField').value = images[0].getAttribute('data-name');
      }
    })();

    // GIF carousel rotate
    (function(){
      const carousel = document.getElementById('gifCarousel');
      if(!carousel) return;
      setInterval(()=> {
        const first = carousel.querySelector('.carousel-item');
        if(first) carousel.appendChild(first);
      }, 2600);
    })();

    // Fetch a random quote from backend /quote (returns {quote:"..."})
    async function loadRandomQuote() {
      try {
        const res = await fetch('/quote');
        if(!res.ok) throw new Error('network');
        const data = await res.json();
        showQuote(data.quote);
      } catch (e) {
        showQuote('You are stronger than you think ‚Äî one step at a time.');
        console.error(e);
      }
    }

    // Display quote
    function showQuote(text){
      const el = document.getElementById('motivationText');
      if(!el) return;
      el.style.opacity = 0;
      setTimeout(()=>{ el.textContent = text; el.style.transition='opacity 250ms'; el.style.opacity = 1; }, 120);
    }

    // New Quote button
    document.getElementById('newQuoteBtn').addEventListener('click', loadRandomQuote);

    // Add custom quote: POST to /my-quote/add (backend must implement)
    document.getElementById('addQuoteBtn').addEventListener('click', async function(){
      const input = document.getElementById('customQuoteInput');
      const text = (input.value || '').trim();
      if(!text){ input.focus(); return; }
      try {
        // send JSON to backend endpoint
        const res = await fetch('/my-quote/add', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({quote: text})
        });
        if(res.ok){
          // clear input and show the newly added quote immediately
          input.value = '';
          showQuote(text + '  ‚Äî (You added this)');
        } else {
          // fallback to showing it locally
          showQuote(text);
        }
      } catch (e) {
        console.error(e);
        showQuote(text + '  ‚Äî (Saved locally)');
      }
    });

    // initial load
    loadRandomQuote();
  </script>

</body>
</html>
